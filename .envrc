# Konductor direnv configuration
# Uses nix-direnv for flake integration with caching
#
# Stack: nix (devshell) + direnv (.envrc) + runme (tasks) + example.env (defaults) + .env (overrides)
#
# Platform-specific devshell selection:
#   Linux: #frontend (konductor + Playwright: all languages, IDE, VM/container build tools, browsers)
#   macOS: #full (all languages + IDE, no VM build tools - Playwright not supported)

WORKSPACE_ROOT="$(pwd)"
# Konductor flake (override via environment: K9_FLAKE=/path/to/local/flake)
K9_FLAKE="${K9_FLAKE:-github:braincraftio/konductor}"

case "$(uname -s)" in
Linux*) use flake "${K9_FLAKE}#frontend" ;;
Darwin*) use flake "${K9_FLAKE}#full" ;;
*) use flake "${K9_FLAKE}#full" ;;
esac

# Load example.env as operational defaults (CI runs on this)
# Load .env.secrets for sensitive credentials (gitignored)
dotenv_if_exists .env.secrets

# Load .env for local overrides (gitignored, secrets, custom config)
dotenv_if_exists .env

# =============================================================================
# MCP Server Credentials (Claude Code)
# Credentials loaded from example.env (defaults) and .env (overrides)
# =============================================================================
# GitHub MCP: maps GITHUB_TOKEN to what the server expects
export GITHUB_PERSONAL_ACCESS_TOKEN="${GITHUB_TOKEN:-}"

export OPENCODE_CONFIG="${WORKSPACE_ROOT}/opencode.json"
